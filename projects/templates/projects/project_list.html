<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SEED-Projects</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.9.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
body {
            font-family: 'Arial', sans-serif;
            background-color: #f4f4f4;
            color: #333;
            margin: 0;
            padding: 20px;
        }
        .top_navi {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        .top_left, .top_right {
            padding: 10px;
        }
        .todo-list-container {
            text-align: right;
            margin-bottom: 20px;
        }
        .project-container {
            background-color: #dddddd;
            border: 1px solid #ddd;
            border-radius: .25rem;
            box-shadow: 0 .125rem .25rem rgba(0,0,0,.075);
            padding: 20px;
            margin-bottom: 20px;
        }
        .card {
            background-color: white;
            margin-bottom: 10px;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        .list-group-item {
            background-color: white;
            margin-bottom: 5px;
            padding: 10px;
            border-radius: 4px;
        }
        .btn, .form-control, .form-group {
            margin-top: 10px;
        }
        .btn-primary {
            background-color: #333;
        }
        .btn-danger {
            background-color: #333;
        }
        .week-container {
            display: flex;
            align-items: center;
            overflow-x: hidden;
            white-space: nowrap;
        }
        .week-scroll {
            display: flex;
            overflow-x: auto;
            scroll-behavior: smooth;
            margin: 0;
            padding: 0;
           }
        .week-arrow {
            cursor: pointer;
            font-size: 24px;
            color: #333;
            margin: 0 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .week-arrow:hover {
            color: #007bff;
            text-shadow: 0px 0px 8px rgba(0,123,255,0.5);
        }
        .week {
            flex: 0 0 calc(100% / 3 - 100px);
            width: calc(100% / 3);
            margin-right: 80px;
            background-color: #dddddd;
            border-radius: 10px;
            padding: 0px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);

        }
    </style>

    <script>
        function Time() {
            var options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit', timeZone: 'America/New_York', timeZoneName: 'short' };
            document.getElementById('CurrentTime').innerText = new Date().toLocaleTimeString('en-US', options);
        }
        setInterval(Time, 1000);


        function StartDate() {
            selectedStartDate = document.getElementById('startDateChoose').value;
            document.getElementById('start_date').innerText = 'Start Date: ' + selectedStartDate;
            calculateWeekDifference();
        }
        var selectedStartDate;

        function calculateWeekDifference() {
            var timeDifference = document.getElementById('timeDifference');

            if (selectedStartDate) {
                var startDate = new Date(selectedStartDate);
                var now = new Date();
                var differenceInTime = now.getTime() - startDate.getTime();
                var differenceInDays = differenceInTime / (1000 * 3600 * 24);
                var differenceInWeeks = Math.ceil(differenceInDays / 7);

                if (differenceInWeeks > 10) {
                    timeDifference.innerText = "Completed!";
                } else {
                    timeDifference.innerText = "Week " + differenceInWeeks;
                }
            } else {
                timeDifference.innerText = "";
            }
        }

    </script>
</head>
<body>
<div class="top_navi">
    <div class="top_left">
        <span>Hello, {{ user.username }}   </span>
        <br>
        <span id="CurrentTime"></span>
        <br>
         <span id="start_date">Selected Start Date:</span>
        <input type="date" id="startDateChoose">
        <button onclick="StartDate(); calculateWeekDifference()">Confirm</button>
    </div>

    <div class="top_right">
        <a href="{% url 'user_management' %}" class="btn btn-secondary btn-sm">User Management</a>
        <br>
        <a href="{% url 'login' %}" class="btn btn-secondary btn-sm">Log out</a>

    </div>
</div>


<div class="todo-list-container">
    <h2>
        Todo List
        <br>
        <span id="timeDifference"></span>
    </h2>
    <ul class="list-group">
        {% for project in incomplete_projects %}
            <li class="list-group-item">
                {{ project.name }}
                <span>{{ project.status }}</span>
            </li>
        {% endfor %}
    </ul>
</div>

<div class="project-container">
    <div class="row">
        <div class="col-md-8">
            <h1>Project List</h1>

            {% for project in projects %}
                <div class="card mb-3">
                    <div class="card-body">
                        <h2 class="card-title">{{ project.name }}</h2>
                        <p class="card-text">{{ project.description }}</p>
                        <p>Status: {{ project.status }}</p>
                        <a href="{% url 'delete_project' project.id %}" class="btn btn-danger">Delete Project</a>

                        <h4>Steps:</h4>
                        <ul class="list-group">
                            {% for step in project.steps.all %}
                                <li class="list-group-item">
                                    {{ step.name }} - Status: {{ step.status }}
                                    <form method="post" action="{% url 'edit_step_status' step.id %}" class="form-inline">
                                        {% csrf_token %}
                                        <select name="status" class="form-control mr-2">
                                            <option value="Not Started" {% if step.status == "Not Started" %} selected {% endif %}>Not Started</option>
                                            <option value="In Progress" {% if step.status == "In Progress" %} selected {% endif %}>In Progress</option>
                                            <option value="Completed" {% if step.status == "Completed" %} selected {% endif %}>Completed</option>
                                        </select>
                                        <button type="submit" class="btn btn-sm btn-primary">Update Step Status</button>
                                    </form>
                                    <a href="{% url 'delete_step' step.id %}" class="btn btn-sm btn-danger">Delete Step</a>
                                </li>
                            {% endfor %}
                        </ul>

                        <form method="post" action="{% url 'add_step' project.id %}" class="form">
                            {% csrf_token %}
                            <div class="form-group">
                                <label for="step_name">Add Step:</label>
                                <input type="text" name="step_name" required class="form-control">
                            </div>
                            <div class="form-group">
                                <label for="step_status">Status:</label>
                                <select name="step_status" class="form-control">
                                    <option value="Not Started">Not Started</option>
                                    <option value="In Progress">In Progress</option>
                                    <option value="Completed">Completed</option>
                                </select>
                            </div>
                            <button type="submit" class="btn btn-primary">Add Step</button>
                        </form>
                    </div>
                </div>
            {% endfor %}

            <h2>Add New Project</h2>
            <form method="post" class="form">
                {% csrf_token %}
                {{ form.as_p }}
                <button type="submit" class="btn btn-primary">Add</button>
            </form>
        </div>


    </div>
</div>

<div class="week-container">

        <div class="week-arrow" onclick="scrollWeeks('left')">
            <i class="bi bi-arrow-left-circle"></i>
        </div>

        <div class="week-scroll">

            {% for week in "1234567890" %}

                <div class="week">
                    <div class="week-header">Week {{ week }}</div>
                    {% for project in projects %}
                    <div>{{ project.name }}</div>
                    {% endfor %}
                </div>
            {% endfor %}
        </div>
        <div class="week-arrow" onclick="scrollWeeks('right')">
            <i class="bi bi-arrow-right-circle"></i>
        </div>
</div>

<script> Time() ; </script>
<script> StartDate() ; </script>
<script> calculateWeekDifference() ; </script>
<script>

    function scrollWeeks(direction) {
        var container = document.querySelector('.week-scroll');
        var scrollAmount = container.offsetWidth / 3;
        if (direction === 'left') {
        container.scrollLeft -= scrollAmount;
    } else {
        container.scrollLeft += scrollAmount;
    }
}
</script>

</body>
</html>